(window.webpackJsonp=window.webpackJsonp||[]).push([[2],{290:function(e,t,n){"use strict";n.r(t);var r=n(47),o=n(509),c=n(342);function i(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var u=function(e){return{type:"ADD_MESSAGE",message:e}},a=function(e){var t=e.userId,n=e.sessionId,r=e.channel;return JSON.stringify([r,t,n])},s=Object(c.c)({messages:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"ADD_MESSAGE":return[].concat(i(e),[t.message])}return e},options:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{channel:"",sessionId:"",userId:""},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_OPTIONS":return t.options}return e}}),l=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:s(void 0,{type:""}),t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"RESET_STATE":return s(t.state,{type:""})}return s(e,t)},f=function(e){return function(t){return function(n){var r=a(e.getState().options);switch(n.type){case"SET_OPTIONS":var o=a(n.options),c=localStorage.getItem(o);if(c)try{var i=JSON.parse(c);return t({type:"RESET_STATE",state:i})}catch(e){}}var u=t(n);return localStorage.setItem(r,JSON.stringify(e.getState())),u}}},p=function(e){var t=Object(c.d)(l,Object(c.a)(function(e){return function(t){return function(t){return function(n){switch(n.type){case"SEND_MESSAGE":var r=n.message,o=r.text,c=r.data;return e.sendMessage(o||"",c),t(u(n.message))}return t(n)}}}}(e),f));return function(e,t){t.on("output",function(t){return e.dispatch(u(t))})}(t,e),t},y=n(430),h=n(372),b=n.n(h),v=n(346),d=n.n(v);function g(e){return(g="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function m(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function O(e){return(O=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function w(e,t){return(w=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function S(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function k(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var E=function(e){function t(){var e,n,r,o;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var c=arguments.length,i=new Array(c),u=0;u<c;u++)i[u]=arguments[u];return r=this,o=(e=O(t)).call.apply(e,[this].concat(i)),n=!o||"object"!==g(o)&&"function"!=typeof o?S(r):o,k(S(S(n)),"state",{text:""}),k(S(S(n)),"handleChangeState",function(e){n.setState({text:e.target.value})}),k(S(S(n)),"handleSubmit",function(e){e.preventDefault(),e.stopPropagation();var t=n.state.text;t&&n.setState({text:""},function(){n.props.onSendMessage(t,null)})}),n}var n,o,c;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&w(e,t)}(t,r["PureComponent"]),n=t,(o=[{key:"render",value:function(){this.props;var e=this.state.text;return r.createElement("form",{onSubmit:this.handleSubmit},r.createElement(d.a,{autoFocus:!0,value:e,onChange:this.handleChangeState}),r.createElement(b.a,{disabled:!e,type:"submit"},"send"))}}])&&m(n.prototype,o),c&&m(n,c),t}(),_=n(424),j=n(683),P=n.n(j);function x(){return(x=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function C(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},c=Object.keys(e);for(r=0;r<c.length;r++)n=c[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(e);for(r=0;r<c.length;r++)n=c[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var I=function(e){e.headerLogoUrl;var t=C(e,["headerLogoUrl"]);return r.createElement(_.a,x({position:"static"},t,{color:"primary"}),r.createElement(_.d,null,r.createElement(_.b,{container:!0,alignItems:"center",spacing:8},r.createElement(_.b,{item:!0,style:{flexGrow:1}},r.createElement(_.e,{variant:"title"},"Webchat")),r.createElement(_.b,{item:!0},r.createElement(_.c,null,r.createElement(P.a,null))))))},T=n(307),R=n(330),U=n.n(R);function M(e){return(M="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function D(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function A(e,t){return!t||"object"!==M(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function W(e){return(W=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function L(e,t){return(L=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var B=function(e){function t(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=A(this,W(t).call(this,e))).state={theme:U()()},n}var n,o,c;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&L(e,t)}(t,r["PureComponent"]),n=t,(o=[{key:"render",value:function(){var e=this.props,t=this.state,n=e.messages,o=e.onSendMessage,c=(e.config,t.theme);return r.createElement(T.MuiThemeProvider,{theme:c},r.createElement("div",null,r.createElement(I,{headerLogoUrl:"config.settings.headerLogoUrl"}),n.map(function(e){return r.createElement("p",null,e.text)}),r.createElement(E,{onSendMessage:o})))}}])&&D(n.prototype,o),c&&D(n,c),t}(),F=Object(y.b)(function(e){return{messages:e.messages}},function(e){return{onSendMessage:function(t,n){return e({type:"SEND_MESSAGE",message:{text:t,data:n}})}}})(B);function N(e){return(N="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function J(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function G(e){return(G=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Y(e,t){return(Y=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function q(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function z(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}n.d(t,"Webchat",function(){return H});var H=function(e){function t(e){var n,r,c;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),r=this,n=!(c=G(t).call(this,e))||"object"!==N(c)&&"function"!=typeof c?q(r):c,z(q(q(n)),"client",void 0),z(q(q(n)),"store",void 0);var i=e.url,u=e.options;return n.client=new o.WebchatClient(i,u),n.store=p(n.client),n}var n,c,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Y(e,t)}(t,r["PureComponent"]),n=t,(c=[{key:"componentDidMount",value:function(){var e=this;this.client.connect().then(function(){e.store.dispatch({type:"SET_OPTIONS",options:e.client.socketOptions})})}},{key:"componentWillUnmount",value:function(){this.client.disconnect()}},{key:"render",value:function(){var e=this.client.webchatConfig;return r.createElement(y.a,{store:this.store},r.createElement(F,{config:e}))}}])&&J(n.prototype,c),i&&J(n,i),t}()},509:function(e,t,n){"use strict";function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){return!t||"object"!==r(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function c(e,t,n){return(c="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=i(e)););return e}(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function i(e){return(i=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function u(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function a(e,t,n){return t&&u(e.prototype,t),n&&u(e,n),e}function s(e,t){return(s=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var l=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(o,c){function i(e){try{a(r.next(e))}catch(e){c(e)}}function u(e){try{a(r.throw(e))}catch(e){c(e)}}function a(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(i,u)}a((r=r.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});var f=n(510),p=n(538),y=function(e){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=t.getEndpointBaseUrl(e),c=t.getEndpointUrlToken(e),u=t.createWebchatOptions(n);return o(this,i(t).call(this,r,c,u))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&s(e,t)}(t,f.SocketClient),a(t,null,[{key:"createDefaultWebchatOptions",value:function(){return{channel:"webchat-client"}}},{key:"createWebchatOptions",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object.assign({},t.createDefaultWebchatOptions(),e)}},{key:"fetchWebchatConfig",value:function(e){return l(this,void 0,void 0,regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,p.default.get(e);case 2:return t.abrupt("return",t.sent.data);case 3:case"end":return t.stop()}},t,this)}))}},{key:"getEndpointBaseUrl",value:function(e){var t=e.split("/");return t.splice(t.length-1,1),t.join("/")}},{key:"getEndpointUrlToken",value:function(e){return e.split("/").pop()}}]),a(t,[{key:"connect",value:function(){var e=this,n=Object.create(null,{connect:{get:function(){return c(i(t.prototype),"connect",e)}}});return l(this,void 0,void 0,regeneratorRuntime.mark(function e(){var r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.fetchWebchatConfig(this.webchatConfigUrl);case 2:return r=e.sent,this.webchatConfig=r,e.abrupt("return",n.connect.call(this));case 5:case"end":return e.stop()}},e,this)}))}},{key:"webchatConfigUrl",get:function(){return"".concat(this.socketUrl,"/").concat(this.socketURLToken)}}]),t}();t.WebchatClient=y},510:function(e,t,n){"use strict";function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function c(e,t){return!t||"object"!==r(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function i(e){return(i=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function u(e,t){return(u=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var a=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(o,c){function i(e){try{a(r.next(e))}catch(e){c(e)}}function u(e){try{a(r.throw(e))}catch(e){c(e)}}function a(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(i,u)}a((r=r.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});var s=n(511),l=n(512),f=n(535),p=function(e){function t(e,n,r){var o;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(o=c(this,i(t).call(this))).messageBuffer=[],o.socketUrl=e,o.socketURLToken=n,o.socketOptions=t.completeSocketOptions(r),o.updateLastUsed(),o}var n,r,p;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&u(e,t)}(t,s.EventEmitter),n=t,p=[{key:"createDefaultSocketOptions",value:function(){return{channel:"socket-client",userId:"user-".concat(f.v4()),sessionId:"session-".concat(f.v4()),expiresIn:null,forceWebsockets:!1,interval:1e4,passthroughIP:null,reconnection:!0,reloadFlow:!1,resetContext:!1,resetFlow:!1,resetState:!1}}},{key:"completeSocketOptions",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object.assign({},t.createDefaultSocketOptions(),e)}}],(r=[{key:"flushMessageBuffer",value:function(){if(this.messageBuffer.length>0)if(this.connected){console.log("[SocketClient] Starting to send your buffered messages...");var e=!0,t=!1,n=void 0;try{for(var r,o=this.messageBuffer[Symbol.iterator]();!(e=(r=o.next()).done);e=!0){var c=r.value;this.sendMessage(c.text,c.data)}}catch(e){t=!0,n=e}finally{try{e||null==o.return||o.return()}finally{if(t)throw n}}console.log("[SocketClient] Finished sending ".concat(this.messageBuffer.length," buffered messages.")),this.messageBuffer=[]}else console.log("[SocketClient] Could not send your buffered messages because we are not connected")}},{key:"setupReconnectInterval",value:function(){var e=this;this.socketReconnectInterval=setInterval(function(){return a(e,void 0,void 0,regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.connected){e.next=12;break}return console.log("[SocketClient] Trying to reconnect"),e.prev=2,e.next=5,this.connect();case 5:console.log("[SocketClient] Successfully reconnected."),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(2),console.error("[SocketClient] Failed to reconnect, error was: ".concat(JSON.stringify(e.t0)));case 11:case 12:case"end":return e.stop()}},e,this,[[2,8]])}))},this.socketOptions.interval)}},{key:"updateLastUsed",value:function(){this.lastUsed=Date.now()}},{key:"connect",value:function(){return a(this,void 0,void 0,regeneratorRuntime.mark(function e(){var t,n=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return(t=l.connect(this.socketUrl,{reconnection:!1,upgrade:!0,transports:this.socketOptions.forceWebsockets?["websocket"]:["polling","websocket"]})).on("error",function(e){return n.emit("error",e)}),t.on("exception",function(e){return n.emit("exception",e)}),t.on("typingStatus",function(e){return n.emit("typingStatus",e)}),t.on("finalPing",function(e){return n.emit("finalPing",e)}),t.on("output",function(e){if(e&&"error"===e.type)return n.emit("error",e.data.error);if(e&&"output"===e.type){var t=e.data;n.emit("output",t)}}),e.abrupt("return",new Promise(function(e,r){t.on("connect_error",function(){return r(new Error("[SocketClient] Error connecting"))}),t.on("connect_timeout",function(){return r(new Error("[SocketClient] Error connecting"))}),t.on("connect",function(){console.log("[SocketClient] connection established"),n.socket=t,n.flushMessageBuffer(),n.socketOptions.reconnection&&n.setupReconnectInterval(),e(n)})}));case 7:case"end":return e.stop()}},e,this)}))}},{key:"disconnect",value:function(){return clearInterval(this.socketReconnectInterval),this.socketReconnectInterval=null,this.socket&&(this.socket.disconnect(),this.socket=null),this}},{key:"sendMessage",value:function(e,t){return this.connected?(this.updateLastUsed(),this.socket.emit("processInput",{URLToken:this.socketURLToken,userId:this.socketOptions.userId,sessionId:this.socketOptions.sessionId,source:"device",passthroughIP:this.socketOptions.passthroughIP,reloadFlow:!!this.socketOptions.reloadFlow,resetFlow:!!this.socketOptions.resetFlow,resetState:!!this.socketOptions.resetState,resetContext:!!this.socketOptions.resetContext,text:e,data:t})):(this.messageBuffer.push({text:e,data:t}),console.log("[SocketClient] Unable to directly send your message since we are not connected. Your message will be buffered and sent later on.")),this}},{key:"connected",get:function(){return!!this.socket&&this.socket.connected}},{key:"expired",get:function(){return null!==this.socketOptions.expiresIn&&Date.now()-this.lastUsed>this.socketOptions.expiresIn}}])&&o(n.prototype,r),p&&o(n,p),t}();t.SocketClient=p},532:function(e,t){}}]);