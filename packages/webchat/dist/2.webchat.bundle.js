(window.webpackJsonp=window.webpackJsonp||[]).push([[2],{290:function(e,t,n){"use strict";n.r(t);var r=n(366),o=n(58),i=n(367),c=n(318);function u(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var a=function(e){return{type:"ADD_MESSAGE",message:e}};function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){l(e,t,n[t])})}return e}function l(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function f(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var p=function(e,t){t.on("output",function(t){return e.dispatch(a(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){f(e,t,n[t])})}return e}({},t,{source:"bot"})))})},y=function(e){var t=e.userId,n=e.sessionId,r=e.channel;return JSON.stringify([r,t,n])},b=Object(c.c)({messages:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"ADD_MESSAGE":return[].concat(u(e),[t.message])}return e},options:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{channel:"",sessionId:"",userId:""},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_OPTIONS":return t.options}return e}}),h=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:b(void 0,{type:""}),t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"RESET_STATE":return b(t.state,{type:""})}return b(e,t)},g=function(e){return function(t){return function(n){var r=y(e.getState().options);switch(n.type){case"SET_OPTIONS":var o=y(n.options),i=localStorage.getItem(o);if(i)try{var c=JSON.parse(i);return t({type:"RESET_STATE",state:c})}catch(e){}}var u=t(n);return localStorage.setItem(r,JSON.stringify(e.getState())),u}}},m=function(e){var t=Object(c.d)(h,Object(c.a)(function(e){return function(t){return function(t){return function(n){switch(n.type){case"SEND_MESSAGE":var r=n.message,o=r.text,i=r.data;return e.sendMessage(o||"",i),t(a(n.message))}return t(n)}}}}(e),g));return p(t,e),t},d=n(364),v=n(351),O=n.n(v),S=function(e){return function(e){return O()(e).setAlpha(.95).toHslString()}(O()(e).isLight()?"black":"white")},w=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return e.primaryColor||(e.primaryColor="#3f51b5"),e.primaryContrastColor||(e.primaryContrastColor=S(e.primaryColor)),e.greyColor||(e.greyColor="#e6e6e6"),e.greyContrastColor||(e.greyContrastColor=S(e.greyColor)),e.unitSize||(e.unitSize=8),e.blockSize||(e.blockSize=7*e.unitSize),e.cornerSize||(e.cornerSize=e.unitSize/2),e.fontFamily||(e.fontFamily="sans-serif"),e},k=r.a,j={minWidth:40,minHeight:40,boxSizing:"border-box"},C=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.map(function(e){return"".concat(e," .1s ease-out")}).join(", ")};function x(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var P=k.input(function(e){var t=e.theme;return function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){x(e,t,n[t])})}return e}({},j,{boxSizing:"border-box",borderRadius:t.cornerSize,borderColor:"transparent",borderWidth:2,borderStyle:"solid",outline:"none",padding:"".concat(t.unitSize,"px ").concat(2*t.unitSize,"px"),backgroundColor:O()("white").setAlpha(.7).toHslString(),color:O()("black").setAlpha(.8).toHslString(),transition:C("background-color","border-color"),"&:hover":{borderColor:O()(t.primaryColor).setAlpha(.3).toHslString()},"&:focus":{borderColor:t.primaryColor}})});function E(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var _=k.button(function(e){var t=e.color,n=e.theme,r="primary"===t?n.primaryColor:n.greyColor,o="primary"===t?n.primaryContrastColor:n.greyContrastColor;return function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){E(e,t,n[t])})}return e}({},j,{borderRadius:n.cornerSize,padding:"".concat(n.unitSize,"px ").concat(2*n.unitSize,"px"),boxSizing:"border-box",backgroundColor:r,color:o,textTransform:"uppercase",border:"none",cursor:"pointer",fontWeight:"bold","&:disabled":{opacity:.4}})}),R=k.div(function(e){var t=e.color,n=e.theme;switch(t){case"primary":return{backgroundColor:n.primaryColor,color:n.primaryContrastColor};default:return{backgroundColor:n.greyColor,color:n.greyContrastColor}}}),I=k(R)(function(e){var t=e.theme;return{display:"flex",alignItems:"center",flexWrap:"nowrap",paddingLeft:t.unitSize,paddingRight:t.unitSize,minHeight:t.blockSize,boxSizing:"border-box","&>*":{margin:t.unitSize}}});function T(e){return(T="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function z(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function D(e){return(D=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function A(e,t){return(A=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function U(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function M(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var W=k(I)({marginBottom:0}).withComponent("form"),B=function(e){function t(){var e,n,r,o;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var i=arguments.length,c=new Array(i),u=0;u<i;u++)c[u]=arguments[u];return r=this,o=(e=D(t)).call.apply(e,[this].concat(c)),n=!o||"object"!==T(o)&&"function"!=typeof o?U(r):o,M(U(U(n)),"state",{text:""}),M(U(U(n)),"handleChangeState",function(e){n.setState({text:e.target.value})}),M(U(U(n)),"handleSubmit",function(e){e.preventDefault(),e.stopPropagation();var t=n.state.text;t&&n.setState({text:""},function(){n.props.onSendMessage(t,null)})}),n}var n,r,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&A(e,t)}(t,o["PureComponent"]),n=t,(r=[{key:"render",value:function(){this.props;var e=this.state.text;return o.createElement(W,{onSubmit:this.handleSubmit},o.createElement(P,{autoFocus:!0,value:e,onChange:this.handleChangeState,style:{flexGrow:1}}),o.createElement(_,{disabled:!e,color:"primary",type:"submit"},"send"))}}])&&z(n.prototype,r),i&&z(n,i),t}(),F=n(421),L=n.n(F);function N(){return(N=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}var G=function(e){return o.createElement(I,N({color:"primary"},e),o.createElement("span",null,"Logo"),o.createElement("span",{style:{flexGrow:1}},"Webchat"),o.createElement(L.a,null))},H=n(503),J=k.div(function(e){return{display:"flex",flexDirection:"column",width:400,height:600,overflow:"hidden",fontFamily:e.theme.fontFamily,"&>.content":{flexGrow:1,minHeight:0,overflowY:"auto"}}}),Y=k.div({overflowY:"auto",flexGrow:1,minHeight:0}),q=k.div(function(e){var t,n=e.theme,r=e.align,o=2*n.unitSize,i=2*n.unitSize;switch(r){case"right":o=n.blockSize,t="row-reverse";break;case"left":default:i=n.blockSize}return{display:"flex",flexDirection:t,paddingLeft:o,paddingRight:i,"&>*":{marginTop:n.unitSize,marginBottom:n.unitSize}}});function K(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Q=k.div(function(e){var t=e.color,n=e.theme,r=e.align;return function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){K(e,t,n[t])})}return e}({padding:"".concat(n.unitSize,"px ").concat(2*n.unitSize,"px"),borderRadius:n.unitSize},K({},"left"===r?"borderBottomLeftRadius":"borderBottomRightRadius",0),{backgroundColor:"primary"===t?n.primaryColor:n.greyColor,color:"primary"===t?n.primaryContrastColor:n.greyContrastColor})}),V=function(e){var t=e.messages;return o.createElement(Y,null,t.map(function(e){var t=e.text,n=e.source;return o.createElement(q,{align:"bot"===n?"left":"right"},o.createElement(Q,{color:"bot"===n?"primary":"default",align:"bot"===n?"left":"right"},t))}))};function X(e){return(X="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Z(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}function $(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function ee(e){return(ee=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function te(e,t){return(te=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function ne(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var re=function(e){function t(){var e,n,r,o,i,c,u;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var a=arguments.length,s=new Array(a),l=0;l<a;l++)s[l]=arguments[l];return r=this,n=!(o=(e=ee(t)).call.apply(e,[this].concat(s)))||"object"!==X(o)&&"function"!=typeof o?ne(r):o,i=ne(ne(n)),c="state",u={theme:w()},c in i?Object.defineProperty(i,c,{value:u,enumerable:!0,configurable:!0,writable:!0}):i[c]=u,n}var n,r,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&te(e,t)}(t,o["PureComponent"]),n=t,i=[{key:"getDerivedStateFromProps",value:function(e,t){var n=e.config&&e.config.settings&&e.config.settings.colorScheme;return n&&n!==t.theme.primaryColor?{theme:w({primaryColor:n})}:null}}],(r=[{key:"render",value:function(){var e=this.props,t=this.state,n=e.messages,r=e.onSendMessage,i=(e.config,Z(e,["messages","onSendMessage","config"])),c=t.theme;return o.createElement(H.a,{theme:c},o.createElement(J,i,o.createElement(G,null),o.createElement(V,{messages:n}),o.createElement(B,{onSendMessage:r})))}}])&&$(n.prototype,r),i&&$(n,i),t}(),oe=Object(d.b)(function(e){return{messages:e.messages}},function(e){return{onSendMessage:function(t,n){return e({type:"SEND_MESSAGE",message:s({},{text:t,data:n},{source:"user"})})}}})(re);function ie(e){return(ie="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ce(){return(ce=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function ue(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}function ae(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function se(e,t){return!t||"object"!==ie(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function le(e){return(le=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function fe(e,t){return(fe=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var pe=function(e){function t(e){var n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),n=se(this,le(t).call(this,e));var r=e.url,o=e.options,c=new i.WebchatClient(r,o),u=m(c);return n.state={client:c,store:u,config:null},n}var n,r,c;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&fe(e,t)}(t,o["PureComponent"]),n=t,(r=[{key:"componentDidMount",value:function(){var e=this,t=this.state,n=t.client,r=t.store;n.connect().then(function(){r.dispatch({type:"SET_OPTIONS",options:n.socketOptions}),e.setState({config:n.webchatConfig})})}},{key:"componentWillUnmount",value:function(){this.state.client.disconnect()}},{key:"render",value:function(){var e=this.props,t=(e.url,e.options,ue(e,["url","options"])),n=this.state,r=n.store,i=n.config;return i?o.createElement(d.a,{store:r},o.createElement(oe,ce({},t,{config:i}))):null}}])&&ae(n.prototype,r),c&&ae(n,c),t}(),ye=Object(r.a)(pe)({position:"fixed",bottom:64,right:64,width:480,height:640,overflow:"hidden",borderRadius:4,boxShadow:"0px 2px 5px hsla(0, 0%, 0%, .35)"});t.default=ye},367:function(e,t,n){"use strict";function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){return!t||"object"!==r(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function i(e,t,n){return(i="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=c(e)););return e}(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function c(e){return(c=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function u(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function a(e,t,n){return t&&u(e.prototype,t),n&&u(e,n),e}function s(e,t){return(s=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var l=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(o,i){function c(e){try{a(r.next(e))}catch(e){i(e)}}function u(e){try{a(r.throw(e))}catch(e){i(e)}}function a(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(c,u)}a((r=r.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});var f=n(368),p=n(396),y=function(e){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=t.getEndpointBaseUrl(e),i=t.getEndpointUrlToken(e),u=t.createWebchatOptions(n);return o(this,c(t).call(this,r,i,u))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&s(e,t)}(t,f.SocketClient),a(t,null,[{key:"createDefaultWebchatOptions",value:function(){return{channel:"webchat-client"}}},{key:"createWebchatOptions",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object.assign({},t.createDefaultWebchatOptions(),e)}},{key:"fetchWebchatConfig",value:function(e){return l(this,void 0,void 0,regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,p.default.get(e);case 2:return t.abrupt("return",t.sent.data);case 3:case"end":return t.stop()}},t,this)}))}},{key:"getEndpointBaseUrl",value:function(e){var t=e.split("/");return t.splice(t.length-1,1),t.join("/")}},{key:"getEndpointUrlToken",value:function(e){return e.split("/").pop()}}]),a(t,[{key:"connect",value:function(){var e=this,n=Object.create(null,{connect:{get:function(){return i(c(t.prototype),"connect",e)}}});return l(this,void 0,void 0,regeneratorRuntime.mark(function e(){var r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.fetchWebchatConfig(this.webchatConfigUrl);case 2:return r=e.sent,this.webchatConfig=r,e.abrupt("return",n.connect.call(this));case 5:case"end":return e.stop()}},e,this)}))}},{key:"webchatConfigUrl",get:function(){return"".concat(this.socketUrl,"/").concat(this.socketURLToken)}}]),t}();t.WebchatClient=y},368:function(e,t,n){"use strict";function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function i(e,t){return!t||"object"!==r(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function c(e){return(c=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function u(e,t){return(u=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var a=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(o,i){function c(e){try{a(r.next(e))}catch(e){i(e)}}function u(e){try{a(r.throw(e))}catch(e){i(e)}}function a(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(c,u)}a((r=r.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});var s=n(369),l=n(370),f=n(393),p=function(e){function t(e,n,r){var o;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(o=i(this,c(t).call(this))).messageBuffer=[],o.socketUrl=e,o.socketURLToken=n,o.socketOptions=t.completeSocketOptions(r),o.updateLastUsed(),o}var n,r,p;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&u(e,t)}(t,s.EventEmitter),n=t,p=[{key:"createDefaultSocketOptions",value:function(){return{channel:"socket-client",userId:"user-".concat(f.v4()),sessionId:"session-".concat(f.v4()),expiresIn:null,forceWebsockets:!1,interval:1e4,passthroughIP:null,reconnection:!0,reloadFlow:!1,resetContext:!1,resetFlow:!1,resetState:!1}}},{key:"completeSocketOptions",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object.assign({},t.createDefaultSocketOptions(),e)}}],(r=[{key:"flushMessageBuffer",value:function(){if(this.messageBuffer.length>0)if(this.connected){console.log("[SocketClient] Starting to send your buffered messages...");var e=!0,t=!1,n=void 0;try{for(var r,o=this.messageBuffer[Symbol.iterator]();!(e=(r=o.next()).done);e=!0){var i=r.value;this.sendMessage(i.text,i.data)}}catch(e){t=!0,n=e}finally{try{e||null==o.return||o.return()}finally{if(t)throw n}}console.log("[SocketClient] Finished sending ".concat(this.messageBuffer.length," buffered messages.")),this.messageBuffer=[]}else console.log("[SocketClient] Could not send your buffered messages because we are not connected")}},{key:"setupReconnectInterval",value:function(){var e=this;this.socketReconnectInterval=setInterval(function(){return a(e,void 0,void 0,regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.connected){e.next=12;break}return console.log("[SocketClient] Trying to reconnect"),e.prev=2,e.next=5,this.connect();case 5:console.log("[SocketClient] Successfully reconnected."),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(2),console.error("[SocketClient] Failed to reconnect, error was: ".concat(JSON.stringify(e.t0)));case 11:case 12:case"end":return e.stop()}},e,this,[[2,8]])}))},this.socketOptions.interval)}},{key:"updateLastUsed",value:function(){this.lastUsed=Date.now()}},{key:"connect",value:function(){return a(this,void 0,void 0,regeneratorRuntime.mark(function e(){var t,n=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return(t=l.connect(this.socketUrl,{reconnection:!1,upgrade:!0,transports:this.socketOptions.forceWebsockets?["websocket"]:["polling","websocket"]})).on("error",function(e){return n.emit("error",e)}),t.on("exception",function(e){return n.emit("exception",e)}),t.on("typingStatus",function(e){return n.emit("typingStatus",e)}),t.on("finalPing",function(e){return n.emit("finalPing",e)}),t.on("output",function(e){if(e&&"error"===e.type)return n.emit("error",e.data.error);if(e&&"output"===e.type){var t=e.data;n.emit("output",t)}}),e.abrupt("return",new Promise(function(e,r){t.on("connect_error",function(){return r(new Error("[SocketClient] Error connecting"))}),t.on("connect_timeout",function(){return r(new Error("[SocketClient] Error connecting"))}),t.on("connect",function(){console.log("[SocketClient] connection established"),n.socket=t,n.flushMessageBuffer(),n.socketOptions.reconnection&&n.setupReconnectInterval(),e(n)})}));case 7:case"end":return e.stop()}},e,this)}))}},{key:"disconnect",value:function(){return clearInterval(this.socketReconnectInterval),this.socketReconnectInterval=null,this.socket&&(this.socket.disconnect(),this.socket=null),this}},{key:"sendMessage",value:function(e,t){return this.connected?(this.updateLastUsed(),this.socket.emit("processInput",{URLToken:this.socketURLToken,userId:this.socketOptions.userId,sessionId:this.socketOptions.sessionId,source:"device",passthroughIP:this.socketOptions.passthroughIP,reloadFlow:!!this.socketOptions.reloadFlow,resetFlow:!!this.socketOptions.resetFlow,resetState:!!this.socketOptions.resetState,resetContext:!!this.socketOptions.resetContext,text:e,data:t})):(this.messageBuffer.push({text:e,data:t}),console.log("[SocketClient] Unable to directly send your message since we are not connected. Your message will be buffered and sent later on.")),this}},{key:"connected",get:function(){return!!this.socket&&this.socket.connected}},{key:"expired",get:function(){return null!==this.socketOptions.expiresIn&&Date.now()-this.lastUsed>this.socketOptions.expiresIn}}])&&o(n.prototype,r),p&&o(n,p),t}();t.SocketClient=p},390:function(e,t){}}]);